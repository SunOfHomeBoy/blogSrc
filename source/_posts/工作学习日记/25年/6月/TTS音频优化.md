# TTS播报优化

## 问题
用 网易开源的 易魔声 做了个 本地的 TTS 服务。现在 把文字转语音的过程中 出现了一些 我认为不太合适的 播报语音。

比如这段话: `2025年06月06日 15:17:48`
我希望读作: `二零二五年 六月 六日 十五点十七分四十八秒`
实际读作: `二千零二十五年 六月六日 十五十七四十八`

方案一:
我自己想到的办法是 使用正则表达式，把 `2025年` 转换为 `2 0 2 5 年`(增加空格后，语音输出就是 单个数字的发音) 或者是 `二零二五年`
时间的 正则表达式 `15:17:48` 转为 `15点17分48秒`


在 TTS 文字转语音的专业开发场景中，这种类似的情况。有没有其他开源的优化解决方案？

---

## 回答


## ✅ **TTS行业内 针对数字、时间、日期的常规处理方式**

专业TTS系统都会有 **` 前端文本标准化（Text Normalization, TN）`** 或 **`文本清洗（Text Preprocessing）`** 模块，这个步骤是把`“原始文本”转换为“适合语音合成”`的标准文本，常用于：

* 数字转为逐字读（如 2025 → 二零二五）
* 时间、日期、金额、缩写、单位 的规范表达
* 非标准词（NSW, Non-Standard Words）的语义补全

---

## 🛠️ **常见开源方案: 自然语言处理（NLP）工具库**

以下方案广泛应用于TTS文本预处理：

| 方案名称                             | 特点                      |
| -------------------------------- | ----------------------- |
| **NeMo PnG BERT**                | NVIDIA方案，内置高质量文本正则和规则库  |
| **TTS-Frontend (腾讯开源)**          | 针对中文，支持数字、日期、金额等规范化     |
| **Pynini FST**                   | 使用有限状态转换器（FST）灵活构建文本规范化 |
| **OSS TTS项目（如EasySora、易魔声社区分支）** | 一些版本自带基础正则，但需自行扩展       |

---

## ⚡ **实用建议与技术方案**

### 1️⃣ 正则表达式手动规则（你提到的方案，适合快速上线）

* 优点：实现简单、规则直观
* 缺点：需维护多种复杂场景，规则堆积
* 示例：

  ```regex
  (\d{4})年 → $1 年 → 二零二五年
  (\d{1,2}):(\d{1,2}):(\d{1,2}) → $1点$2分$3秒
  ```

若需要数字转汉字：
可结合 `num2chinese`、`cn2an` Python库辅助：

```python
import cn2an
cn2an.an2cn('2025')  # 输出：二千零二十五
# 如果想定制为 '二零二五'，需要自定义方法逐字符转换
```

---

### 2️⃣ 使用专门的文本标准化库

**腾讯 TTS-Frontend（[https://github.com/TencentGameMate/tts\_frontend）](https://github.com/TencentGameMate/tts_frontend）)**

* 轻量级，专门为中文TTS准备
* 自带数字、时间、日期、金额等规范
* 可单独使用前端文本规范功能，独立于TTS引擎

---

### 3️⃣ 深度学习方式（适用于大规模、语境灵活场景）

* NeMo Text Normalization （[https://github.com/NVIDIA/NeMo）](https://github.com/NVIDIA/NeMo）)
* 结合BERT、FST、规则，适用于中英文混合
* 上手门槛高，需训练数据、部署环境

---

## 🚀 **综合推荐**

| 需求规模        | 建议方案                |
| ----------- | ------------------- |
| 小规模、自定义需求   | 正则表达式 + cn2an 方案    |
| 中文TTS标准文本处理 | 腾讯 tts\_frontend    |
| 高级复杂语境、跨语言  | NeMo TN、Pynini等深度方案 |

---

## 🎯 **针对你当前情况的实操步骤**

1. 优先用正则表达式快速处理明显问题（如年、时间）
2. 使用 `cn2an` 控制数字到汉字的规范表达，定制“逐字”风格
3. 后续可评估引入 `tts_frontend` 替代部分手动规则

---

## 📦 **补充示例**

```python
import cn2an

def format_date_time(text):
    text = re.sub(r'(\d{4})年', lambda m: f"{' '.join(m.group(1))} 年", text)
    text = re.sub(r'(\d{1,2}):(\d{1,2}):(\d{1,2})', r'\1点\2分\3秒', text)
    return text

print(format_date_time("2025年06月06日 15:17:48"))
# 输出：2 0 2 5 年 06月06日 15点17分48秒
```

---

## 🔧 **你可以告诉我：**

* 你更倾向“逐字读”还是“自然语言读法”？
* 易魔声用的具体是哪套模型、支持不支持前端插件？

我可以帮你写完整的正则/转换方案或推荐适配的现成工具包。要继续深入吗？
