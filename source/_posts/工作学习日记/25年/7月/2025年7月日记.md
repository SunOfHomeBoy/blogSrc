---
title: 2025年7月日记
date: 2025年7月1日 14:04:23
update: 2025年6月26日 14:55:34
tags: 日记
categories: Diary
---
# 2025年7月1日 周二
  + 上午安装 新内存条, 升级至 DDR4 64G
  + 更新 新固态 1.8T 约2T
  + 使用 傲梅磁盘分区助手
    进行磁盘克隆
    - 遇到问题 EFI 磁盘引导分区 未识别
      通过 磁盘管理: BMR -> GPT
    - 傲梅助手 克隆磁盘, 先通过 磁盘管理 删除之前克隆的所有分区
      4K对齐, 设置里面 更改磁盘分区大小
      系统盘扩容到 878G
      新增 E盘 1T
      D盘 931G 不变

  + 下午 压缩混淆 Html JS 代码
    [html-minifier-terser](https://www.npmjs.com/package/html-minifier-terser)
    ```bash
      npm install html-minifier-terser -g

      # 压缩html命令
      > npx html-minifier-terser index.html -o output.html --collapse-whitespace --remove-comments --minify-js --minify-css

      # 压缩html命令2
      npx html-minifier-terser index.html -o output2.html \
        --collapse-whitespace \          # 删除空格 折叠空格（保留必要换行）
        --remove-comments \              # 删除注释 移除注释（保留关键注释）
        --minify-js \                    # 压缩内联 JS
        --minify-css \                   # 压缩内联 CSS
        --no-remove-empty-attributes \   # 保留空属性（如 readonly）
        --no-merge-shortlines \          # 防止长行合并导致问题
        --process-conditional-comments   # 保留条件注释（如 <!--[if IE]>）
        --remove-optional-tags \         # 移除可选标签（如 <html>）
        --remove-redundant-attributes \  # 移除多余属性（如 type="text/javascript"）

      # 合成单行命令
      npx html-minifier-terser index.html -o output2.html --collapse-whitespace --remove-comments --minify-js --minify-css --process-conditional-comments

      # 使用配置文件
      > npx html-minifier-terser index.html -o output.html -c minify.config.json
    ```

  + 压缩 CSS代码
    ```bash
      npm install -g cssnano-cli

      # 仅删除 代码注释

      # 更新 css代码
      docker cp ./index.css digitalman_container:/app/public/css/index.css

      # 添加 demo页面 & 文档
      docker cp ./AIChat_Demo.html digitalman_container:/app/AIChat_Demo.html
      docker cp ./AI数字人前端接入文档.docx digitalman_container:/app/AI数字人前端接入文档.docx
    ```

  + 压缩 JS代码
    ```bash
      npm install -g terser

      # 全局安装后直接运行
      terser voiceSTT.js -o voiceSTT.min.js -c -m
      terser DigitalHumanSocket.js -o DigitalHumanSocket.min.js -c -m
      terser AIChat.js -o AIChat.min.js -c -m
    ```
    + -c/--compress	启用代码压缩（必选，否则仅去注释）
      terser input.js -o output.min.js -c
    + -m/--mangle	混淆变量名（默认混淆局部变量，toplevel 混淆全局变量）
      terser input.js -o output.min.js -c -m

  + 生成 视频压缩脚本
    + 使用 FFmpeg 查看当前视频信息
      ```bash
        ffprobe -v error -show_format -show_streams -i "输入路径/视频.webm"
        ffprobe -v error -show_format -show_streams -i "open_mouth1.webm"
      ```
      + -v error：仅显示错误信息（避免冗余日志）。
      + -show_format：输出视频文件的整体信息（如格式、时长、总码率）。
      + -show_streams：输出视频流（video）和音频流（audio）的详细参数（如编码、分辨率、帧率、码率）。

# 2025年7月2日 周三
  + 把前端配置，尽可能放到后端
  + 温馨提示 逻辑放后端
  + 播放视频流逻辑 放后端
  + 前端调整 交互逻辑

  + 代码压缩混淆
    ```bash
      # 压缩html 全部压缩
      npx html-minifier-terser AIChat_Demo.html -o output.html --collapse-whitespace --remove-comments --minify-js --minify-css
      # 只删除注释
      npx html-minifier-terser AIChat_Demo.html -o output.html -c minify.config.json
      # 压缩js
      terser AIChat.js -o AIChat.min.js -c -m
      terser videoWorker.js -o videoWorker.min.js -c -m
    ```
  + 编写 AIChat 组件

  + 最后统一使用 AIChat 开发前端页面

  + 更新代码
    ```bash
      # 更新代码
      > docker cp ./digital_human_image_frames.py digitalman_container:/app/src/api/digital_human_image_frames.py

    ```

  + 测试发现 大模型还是存在幻觉![Qwen2.5:14b](image.png)

# 2025年7月3日 周四
  + 任务
    1. canvas 换回 video标签
    2. 视频压缩，分辨率 960 -> 480p, 码流 降低

    3. [在线文档地址](https://47.93.245.95:16100/AI%E6%95%B0%E5%AD%97%E4%BA%BA%E5%89%8D%E7%AB%AF%E6%8E%A5%E5%85%A5%E6%96%87%E6%A1%A3.docx)

    4. 尝试 WebGPU + webworker 离屏渲染

  + 更新代码
    ```bash
      # 更新文档 AI数字人前端接入文档.docx
      docker cp ./AI数字人前端接入文档.docx digitalman_container:/app/AI数字人前端接入文档.docx

      # 更新JS
      > docker cp ./videoWorker.js digitalman_container:/app/public/js/videoWorker.js
      > docker cp ./open_mouth4.webm digitalman_container:/app/public/video/open_mouth4.webm
    ```

  + 开会沟通 后续工作安排
    1. 视频优化，AB视频切换
    2. 大模型 流式响应
    3. 形象切换 管理页面，类似现在demo
    4. 反馈机制，用户界面，增加 反馈接口。纯 js接口 + 反馈内容 string
    5. python服务加密

# 2025年7月4日 周五
  + 视频切换逻辑
    前端展示两个视频标签
    同时缓存 两个 视频blob数据
    一个展示，另一个隐藏|透明 opacity: 0
    每次切换视频是 透明另一个

    第一次展示 s 视频，
    此时 缓存 o 视频，并 透明播放
    需要播放 o 视频时，opacity: 1

    3个 video 标签: [s, o1, o2]

    需要展示 s 视频时，隐藏两外两个视频

  + 视频压缩逻辑

  + Agent 优化

# 2025年7月7日 周一
  + 大模型 响应优化
    + 字典访问 替换 点号操作符
      + 点号操作符（dot notation），用于访问对象的属性。
      + 字典访问语法（dictionary-style access），用于从实现了 __getitem__ 方法的对象中获取值，通常用于字典或类似结构。
  + 大模型 流式响应
  + 形象切换 管理页面
    要求: 类似现在 demo, 前后端分离。使用纯JS类模块

    + 前端界面
      + 形象切换模块
      + 声音切换模块
      + 大模型切换模块

    + 后端接口
      + 形象切换接口
      + 声音切换接口
      + 切换大模型接口
      + 反馈切换接口
      + 获取当前形象/声音/模型接口
      + 反馈接口
        + 记录用户反馈时间
        + 结合上下文 生成反馈内容

  + 更新数字人视频文件
    ```bash
      docker cp ./shut_up.webm digitalman_container:/app/public/video/shut_up.webm
    ```
  ## 清华录取率
    + 清华每年在河北省能招200+
      这个比例已经很高了。大大稀释了 天才的含金量。
      当然这些人 估计也会在后面被逐渐 筛掉。

    + 做一个普通人 没什么不好。学会认命。
      + 几十亿分之一的机会，比中彩票概率还小 N倍
      + 既然认命做一个普通人，就得想办法 活得更好
        + 找到自己的出路

# 2025年7月8日 周二
  + [大模型新需求](./大模型新需求.md)

  + 山东交通大脑微前端
    + 开发规范视频
      + 架构图
      + 前端
        + 京东 微前端开源框架
        + 1. 路由配置 本地端口
        + 2. 主题使用
          + --xx-color-primary
          +

# 2025年7月9日 周三
  + 山东交通大脑微前端
    + [需求分析](./阻断需求分析.md)
      +
