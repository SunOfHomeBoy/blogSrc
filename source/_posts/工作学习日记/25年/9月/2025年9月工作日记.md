<!--
 * @Description:
 * @Date: 2025-09-01 10:48:00
 * @LastEditTime: 2025-09-19 13:44:05
 * @FilePath: \blogSrc\source\_posts\工作学习日记\25年\9月\2025年9月工作日记.md
-->
# 2025年9月1日 周一
  + 石太高速
    + 事件工作台 新增接口

# 2025年9月2日 周二
  + 数字人验证 代理服务
    ```bash
      wget 'https://14.78.1.84:3001/dgapi/index.html' --no-check-certificate
      wget 'https://14.78.1.86/index.html' --no-check-certificate
    ```

# 2025年9月3日 周三
  + 2日晚上 23点 - 3日凌晨1点 协助对接方 排查接口数据问题
  + 早上来排查 服务不可用问题
    + 发现 字段拼写错误 mstake -> mStake

  + 数字人服务
    ```bash
      # 重启数字人服务
      docker restart digitalman_container

      # 清空数字人日志文件(无须重启)
      > sudo truncate -s 0 /var/lib/docker/containers/$CONTAINER_ID/$CONTAINER_ID-json.log
      # 1. cd /var/lib/docker/containers 目录
      # 2. docker ps 获取容器ID
      # 3. 删除日志文件
      sudo truncate -s 0 `{$CONTAINER_ID}-json.log`

      # 使用 管道符 写入log日志(sudo 非必须)
      sudo docker logs digitalman_container >> 20250911_1.log

      ## log日志 copy 到 开发目录 /home/os/SSh_Docker_DEV/log

      # 数字人交通事件播报 事件超过10个就只播报各类事件总数量，不播报详细内容
    ```

  + clash 代理规则(解决开启VPN后，无法服务数字人IP 的问题)
    ```
      - 'IP-CIDR,14.78.1.0/24,DIRECT' # 如果两个 IP 在同一网段
    ```

  + 本地调试数字人docker服务[搭建本地开发环境]
    ```bash
      # 跳转到 数字人 本地镜像下载目录
      cd /mnt/c/Users/ZSGX/Downloads/14.78.1.86(数字人Docker镜像)/202509020640

      # 查看当前系统 docker 镜像
      (base) lishichen@DESKTOP-0M2EPFH:/mnt/c/Users/ZSGX/Downloads/14.78.1.86(数字人Docker镜像)/202509020640$ docker images
      REPOSITORY                   TAG       IMAGE ID       CREATED        SIZE
      ollama_qwen3_32b_container   latest    ff500d0aa39c   2 months ago   45.1GB
      ollama/ollama                latest    2ea3b768a8f2   3 months ago   5.22GB
      harpooncorp/harpoon-ext      0.0.6     24dab1cbee4a   2 years ago    19.1MB

      # 本地开发电脑 加载 数字人最新docker镜像
      docker load -i digitalman_9_1.tar
      # 本地运行数字人
      docker run -d --name digitalman_container --restart unless-stopped -p 9880:9880 digitalman_9_1

      # 把服务器 ollama地址 SSH 映射到开发机
      ssh -L 0.0.0.0:11434:localhost:11434 os@14.78.1.86 -Nf
      # 数字人 AI Agent(开启VPN 可以直连 14.78.1.86/index.html, 如果无法访问, 考虑 [clash 代理规则 proxy配置])
      # ssh -L 0.0.0.0:8082:localhost:443 os@14.78.1.86 -Nf

      # 本地测试命令 是可以正常流式响应的
      > curl http://localhost:11434/api/generate -d '{"model": "qwen3:14b", "prompt": "你好，自我介绍"}'
      > curl http://172.27.176.1:11434/api/generate -d '{"model": "qwen3:14b", "prompt": "你好，自我介绍"}'

      # 映射成功后 浏览器访问
      [ollama 本地模型api](http://127.0.0.1:11434/api/tags)

      # 把服务器 emoti SSH 映射到开发机
      ssh -L 0.0.0.0:6005:localhost:6005 os@14.78.1.86 -Nf

      # 更新文件
      docker cp ./Agent_1_2.py digitalman_container:/app/src/LLMAgent/Agent_1_2.py
    ```

    + 开发机 数字人docker服务 安装 git[待实现]
      ```bash
        # docker 安装 git
      ```

  + [docker 开启 python 调试模式](<docker debug python.md>)

# 2025年9月4日 周四
  + 解决 LangChain 报错
    * LLM 或 agent function 响应类型为 json, 但是 没有 action 字段 || action 为空
      1. 这种 json 如何处理？
        补全回答: 当LLM返回的JSON缺少action字段或action为空时，通常是因为模型没有按照预期格式输出。处理这种情况的方法包括：
        - 使用输出解析器（Output Parser）来规范化模型输出
        - 在Agent中启用错误处理机制，如handle_parsing_errors=True
        - 为模型提供更明确的提示词，明确要求输出格式
        - 实现重试机制，当解析失败时重新请求模型生成输出
        - 添加默认处理逻辑，当action为空时执行默认操作或返回错误信息
        * 尝试更换大模型 Qwen3:14b, 32b

      2. LangChain 的 action字段 都有哪些类型？
        回答: [ActionType](https://github.com/langchain-ai/langchain/blob/master/libs/langchain-core/)
        回答: 在LangChain的ReAct Agent中，action字段通常是工具的名称。常见的action类型包括：
        - 工具名称：如"search"、"calculator"、"wikipedia"等，对应已注册的工具
        - "Final Answer"：表示任务完成，直接返回结果
        - 自定义工具名称：根据具体应用定义的工具名称
        具体的action类型取决于你为Agent注册了哪些工具。每个工具在创建时都会指定一个名称，这个名称就是action字段的值。

  + 解决 SSH 代理失效问题
    ```bash
      # ollama 代理
      ssh -L 0.0.0.0:11434:localhost:11434 os@14.78.1.86 -Nf
      # emoti
      ssh -L 0.0.0.0:6005:localhost:6005 os@14.78.1.86 -Nf

      # 过一段时间后 curl http://localhost:11434/api/tags 请求会挂起
      # 再次代理 显示端口被占用
      # 过一段时间后 端口才会被释放
      # 这个问题 第一次出现，且复现频率不高，后面再观察

      # 方法 1：用 lsof 查看（推荐）
      sudo lsof -i :11434

      # 方法 2：用 netstat 查看
      sudo netstat -tulpn | grep :11434

      # 终止单个进程（替换为你的 PID）
      kill -9 12345

      # [直接执行 对应端口即可解决!]如果有多个进程占用，批量终止（谨慎操作！）
      sudo kill -9 $(sudo lsof -t -i :11434)
      sudo kill -9 $(sudo lsof -t -i :6005)

      # 结束进程占用后 再次启动SSH代理

      # 验证
      curl http://localhost:11434/api/tags
      curl http://127.0.0.1:6005/docs
    ```

  + win11 窗口失焦
    现象描述，使用输入法打字, 如果按Esc键，输入框消失，但是编辑器窗口也会失焦。这是什么原因导致的？
    解决:
      结束了 wps 和 360ai 进程，后来失焦现象消失了

  + [LDL]Ubuntu 暴露代理端口
    + xrk: 429 509 760 / 1234567s

    + 目标服务Host:
      - 45.84.180.197
      - 45.84.180.199

    + [Ubuntu服务器](45.84.180.192) 通过 Nginx代理 目标服务端口
      45.84.180.192:8197
      45.84.180.192:8199

    + 步骤分析
      1. 在Ubuntu服务器上使用 Nginx代理 目标服务端口
        Ubuntu 本地访问 8197 端口，访问目标服务端口 45.84.180.197:80
        Ubuntu 本地访问 8199 端口，访问目标服务端口 45.84.180.199:80

      2. 找到 Nginx conf 配置文件，并编辑
        [服务器conf配置副本](服务器反向代理指定端口_nginx.conf)

      3. 重启 Nginx 服务命令
        nginx -s reload

      4. 测试 Nginx 代理
        curl -v http://localhost:8197

        + 测试结果
          ```bash
            root@t-desktop:/etc/nginx# curl -v http://localhost:8197
             *   Trying 127.0.0.1:8197...
             * TCP_NODELAY set
             * connect to 127.0.0.1 port 8197 failed: Connection refused
             * Failed to connect to localhost port 8197: Connection refused
             * Closing connection 0
             curl: (7) Failed to connect to localhost port 8197: Connection refused
          ```
      5. 如何查看 Nginx 是否已监听 对应端口？

      解决问题
      6. sudo nginx -t
        ```bash
          root@t-desktop:/etc/nginx# sudo nginx -t
          nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
          nginx: configuration file /etc/nginx/nginx.conf test is successful
        ```

      7. 查看 Nginx 是否运行
        ```bash
          sudo systemctl status nginx

          root@t-desktop:/etc/nginx# sudo systemctl status nginx
            ● nginx.service - A high performance web server and a reverse proxy server
                 Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)
                 Active: failed (Result: signal) since Sat 2025-07-05 00:00:01 CST; 2 months 0 days ago
                   Docs: man:nginx(8)
                Process: 912 ExecStartPre=/usr/sbin/nginx -t -q -g daemon on; master_process on; (code=exited, status=0/SUCCESS)
                Process: 1195 ExecStart=/usr/sbin/nginx -g daemon on; master_process on; (code=exited, status=0/SUCCESS)
               Main PID: 106257 (code=killed, signal=KILL)

            11月 22 05:10:30 t-desktop systemd[1]: Starting A high performance web server and a reverse proxy server...
            11月 22 05:10:30 t-desktop systemd[1]: Started A high performance web server and a reverse proxy server.
            7月 05 00:00:01 t-desktop systemd[1]: nginx.service: Main process exited, code=killed, status=9/KILL
            7月 05 00:00:01 t-desktop systemd[1]: nginx.service: Failed with result 'signal'.

          # 检查系统日志
          sudo journalctl -u nginx.service
          sudo dmesg | grep -i kill

          # 检查内存使用情况
          free -h
          cat /proc/meminfo

          # 测试配置文件
          sudo nginx -t

          # 尝试启动 Nginx
          sudo systemctl start nginx

          # 使用 sudo systemctl start nginx 命令，成功启动 Nginx 服务，并且可以正常返回代理
        ```

    + 在 windows 上使用ssh映射端口
      ```bash
        ssh -L 0.0.0.0:8197:localhost:8197 t@45.84.180.192 -Nf
        ssh -L 0.0.0.0:8199:localhost:8199 t@45.84.180.192 -Nf

        ssh -L 0.0.0.0:81:localhost:80 t@45.84.180.192 -Nf

        # windows 可以 localhost:8197 | 8199 访问
        # Nginx 有时需要 覆盖 80端口 默认服务器
        # default_server; 字段
        # [详见](服务器反向代理指定端口_nginx.conf#L65)
      ```

# 2025年9月5日 周五
  + 数字人
    ```bash
      # 更新文件
      docker cp ./digital_human_answers_questions_app.py digitalman_container:/app/src/LLMAgent/FunctionCalling/digital_human_answers_questions_app.py

      # 清空 服务器数字人 log日志[tab补全]
      cd /var/lib/docker/containers/4a
      # 清空 log[tab补全]
      sudo truncate -s 0 4a…….log

      # 检查 服务器 数字人服务(忽略证书)
      wget 'https://localhost:443/index.html' --no-check-certificate
    ```

    + [数字人项目问题记录](接口问题记录.md)
      已在微信群反馈

    + API
      `http://14.78.1.84:3001/dgapi/api/digital_human_fames`

    + 本地验证 接入方式

# 2025年9月8日 周一
  + 数字人 服务代理需求分析
    1. Vite、Webpack 开发模式，使用 proxy代理
    2. 生产模式，build 后，使用 nginx 代理
      1. 先把 html 静态资源放入静态目录下，如：/var/www/html/digital_human_fames/index.html
      2. 配置 nginx 代理
      3. 启动 nginx
    3. 经过验证测试，可以支持 代理访问

  + 石太高速
    + 测试 路网管理 地图功能
    + 综合运行监测 拥堵情况图层 和 路线地图图层 同时展示

# 2025年9月9日 周二
  + 视频算法
    + 昨晚下班前[拷贝资料](E:/Project/videoFrameCalc/README.md)
    + git 仓库
      + 图像二级复核算法 https://codeup.aliyun.com/5f97b1a09cffa29cfdd3c76e/Product/RailwayProduct/PictureAlgorithm.git
      + 视频实时检测算法 https://codeup.aliyun.com/5f97b1a09cffa29cfdd3c76e/Product/RailwayProduct/VideoAlgorithm.git
      + 一级平台图像复核算法 https://codeup.aliyun.com/5f97b1a09cffa29cfdd3c76e/Product/RailwayProduct/PictureAlgorithmForCenter.git
    + 拉取 [二级平台算法仓库](E:\Project\videoFrameCalc\Code\PictureAlgorithm)
    + 运行
      + 图像符合算法(已在本地运行)
        + 使用 ApiFox 测试
      + 视频实时检测算法(已在本地运行)
      + 一级平台 ANCC检测算法(不支持本地运行, 功能类似二级平台图像符合算法)
    + 跳板机/服务器 地址
      16:9工作站Todesk：232837977/1234567s
      操作系统用户名密码：DAI/DAI
      RayLink
      设备代码：751 078 564
      访问密码：123456Ab
      <!-- RayLink下载地址：https://www.raylink.live/download.html -->

      21:9工作站Todesk：815886728/Ab123456
      向日葵：757718741/a123456
      操作系统用户名密码：OS/deguroon.20135

      10.189.230.22  z/123.com@
      10.189.230.23  z/123.com@
      10.189.230.10  z/123.com@
    + [环境搭建](算法平台搭建开发运行环境.md)

# 2025年9月10日 周三 - 周五
  + wsl 开启镜像网络
    ```powershell
      # windows Home 环境变量
      $env:USERPROFILE
      # 示例
      cd $env:USERPROFILE

      # 查看 .wslconfig 里有没有显式打开
      > Get-Content $env:USERPROFILE\.wslconfig
        Get-Content : 找不到路径“C:\Users\ZSGX\.wslconfig”，因为该路径不存在。
        所在位置 行:1 字符: 1
        + Get-Content $env:USERPROFILE\.wslconfig
        + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
            + CategoryInfo          : ObjectNotFound: (C:\Users\ZSGX\.wslconfig:String) [Get-Content], ItemNotFoundException
            + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.GetContentCommand

      # 检测IP端口连通性
      Test-NetConnection 192.168.0.201 -Port 554 | Select-Object TcpTestSucceeded
      # 根据返回值 快速显示结果 True 即为通 / False 表示被防火墙或设备拒绝。
      TcpTestSucceeded
      ----------------
                  True

      # 创建新文件
      New-Item -Path $env:USERPROFILE\.wslconfig -ItemType File

      # 写入内容
      @"
        [wsl2]
        networkingMode=mirrored
      "@ > $env:USERPROFILE\.wslconfig

      # PowerShell | CMD 执行以下命令 终止所有WSL实例
      wsl --shutdown

      # 启动一个WSL发行版（例如Ubuntu）来重新激活WSL
      wsl -d Ubuntu

      # 直接输入 wsl 启动默认发行版
      wsl
    ```

    ```bash
      # wsl 检测IP端口连通性

      # 安装 nmap
      sudo apt update && sudo apt install -y nmap

      # 检测IP端口连通性
      nmap -p 554 192.168.0.201 | grep 554
      554/tcp open  rtsp

      # 554/tcp open  rtsp: 说明 TCP 554 已开放;
      # closed/filtered 就是不通


      # 验证镜像网络是否已开启
      # 1. 在WSL内部检查网络配置
      > ip addr show
        1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
            link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
            inet 127.0.0.1/8 scope host lo
               valid_lft forever preferred_lft forever
            inet 10.255.255.254/32 brd 10.255.255.254 scope global lo
               valid_lft forever preferred_lft forever
            inet6 ::1/128 scope host
               valid_lft forever preferred_lft forever
        2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
            link/ether 00:15:5d:60:48:f2 brd ff:ff:ff:ff:ff:ff
            inet 172.27.176.7/20 brd 172.27.191.255 scope global eth0
               valid_lft forever preferred_lft forever
            inet6 fe80::215:5dff:fe60:48f2/64 scope link
               valid_lft forever preferred_lft forever

      # 2. 检查网络接口配置，镜像网络模式下应该能看到类似 eth0 的接口以及对应的IP地址。
      # 3. 在Windows上使用以下PowerShell命令查看WSL网络状态：
      > Get-NetAdapter | Where-Object {$_.InterfaceDescription -like "*WSL*"}

      # 5.检查WSL配置是否生效：
      > wsl --list --verbose
      > wsl -l -v
        NAME              STATE           VERSION
      * Ubuntu-20.04      Running         2
        docker-desktop    Stopped         2
        Ubuntu            Stopped         2
        Ubuntu-18.04      Stopped         2

      # 1. 配置镜像网络（一次性）
      @"
      [wsl2]
      networkingMode=mirrored
      "@ | Out-File -Encoding ascii $env:USERPROFILE\.wslconfig

      # 2. 重启 WSL
      wsl --shutdown
      wsl

      # 3. 验证
      # 方法①: PS命令行 ncpa.cpl | ipconfig 里看 vEthernet (WSL) 消失
      # 方法②: WSL 里 ping/nmap 局域网其他 IP
    ```

  + 跳板机配置服务器端口映射
    [跳板机:SSH端口映射,frp服务部署地址](D:\Program Files\frp_0.51.0_windows_amd64-2)

    - 配置流程
      * [frp部署包](../6月/frp_0.51.0_windows_amd64-2.zip)
      * 配置文件 frpc.ini
        ```ini
          - [common] # 字段不要动
            server_addr = 47.93.245.95 # 阿里云服务器地址
            server_port = 16001 # frp服务端口

          - [ssh111] # 映射名称 可以自定义(支持多个)
            type = tcp # 默认类型
            local_ip = 192.168.0.26 // 映射IP
            local_port = 443 // 映射端口
            remote_port = 16080 // 远程端口
            # 目前使用 080 081 082 端口
          - [ssh222] # 映射名称 可以自定义(支持多个)

          - [sshPictureAlg1]
            type = tcp
            local_ip = 10.189.230.22
            local_port = 22
            remote_port = 16080

          - [sshPictureAlg2]
            type = tcp
            local_ip = 10.189.230.23
            local_port = 22
            remote_port = 16081

          - [sshPictureAlg3]
            type = tcp
            local_ip = 10.189.230.10
            local_port = 22
            remote_port = 16082

        ```
    - 运行代理
      双击 start.bat 运行代理，成功后 显示 success 启动成功, 如果失败 则是端口被占用

  + [Docker算法服务自启动](@张磊)
    * 任务描述: 整理 10, 21, 22, 23 服务器 docker容器 管理方案，设置 docker镜像 自启动，同时自执行 图形算法服务运行命令
    (我@张磊)之前让算法设置这几台算法服务自启动，因为算法所在服务器频繁重启，现在我看貌似没有自启动。
    廉总让你帮忙设置下，
    IP为：10.189.230.10, 10.189.230.22, 10.189.230.23

    - [(图像)二级平台复核:10.189.230.10服务器]：
      ```bash
        docker start c165
        docker exec -it c165 bash
          cd /home/data/ultralytics/
          conda activate y8
          python -m http.server & python recive_file.py

        # 图像平台 run 命令(富豪)
        docker run -it --security-opt seccomp:unconfined -p 5001:5001 -p 8000:8000 -v /home/z/模板:/home/data --shm-size 32g continuumio/miniconda3 /bin/bash
      ```

    - [一级平台复核:10.189.230.21服务器](一级平台部署多家服务商服务容器, 暂时不用更改docker启动方式)
      ```bash
        docker start 3e
        docker exec -it 3e bash
          cd /home/deguroon/
          conda activate y8
          sudo netstat -tulpn | grep 端口号
          kill -9 进程PID
          gunicorn -w 10 -b 0.0.0.0:5001 recive_file_one_pingtai:app
      ```

    - [(视频)二级平台摄像机主动告警:[10.189.230.22:容器名称:ca51,10.189.230.23:容器名称:fecb]]
      ```bash
        docker start ca51
        docker exec -it ca51 bash
          cd /home/data/ultralytics/
          conda activate y8
          python -m http.server & python vi.py

        # 视频平台 run 命令(富豪)
        docker run -it --gpus all --cpus 36 -p 5000:5000 -p 8082:8082 -v /home/z/模板:/home/data --shm-size 32g e3af5c5202c9 /bin/bash

        # 调整后 反推命令
        docker run -d \
          --name graphics_algorithm \
          --restart=always \
          --gpus all \
          --cpus 36 \
          -p 5000:5000 \
          -p 8000:8000 \
          -p 8082:8082 \
          -v /home/z/模板:/home/data \
          --shm-size 64g \
          graphics_algorithm_image \
          /bin/bash -c "cd /home/data/ultralytics/ && conda activate y8 && python -m http.server 8000 & python vi.py && tail -f /dev/null"
      ```

    + 需求分析
      1. 整理 [10.189.230.10, 10.189.230.22, 10.189.230.23] 上述三台服务器 docker容器 启动命令
      2. 使用 docker commit 备份当前容器 -> 创建新镜像
      3. 尝试调整当前的容器启动命令
         1. 支持跟随 服务器 自动启
         2. 启动容器时，自动执行 启动python服务命令行

    + 10.189.230.10 服务器 执行步骤
      ```bash
        # 获取容器基础信息
        docker inspect c16507e0fa66 --format='
          容器名称: {{.Name}}
          镜像: {{.Config.Image}}
          入口点: {{json .Config.Entrypoint}}
          命令: {{json .Config.Cmd}}
          工作目录: {{.Config.WorkingDir}}
          环境变量: {{range .Config.Env}}{{println "  " .}}{{end}}
          端口映射: {{range $p, $conf := .NetworkSettings.Ports}}{{println "  " $p "->" (index $conf 0).HostPort}}{{end}}
          挂载点: {{range .Mounts}}{{println "  " .Source "->" .Destination}}{{end}}
          重启策略: {{.HostConfig.RestartPolicy.Name}}
        '

        # 运行结果
        容器名称: /lucid_cartwright
          镜像: e3af5c5202c9
          入口点: ["/opt/nvidia/nvidia_entrypoint.sh"]
          命令: ["/bin/bash"]
          工作目录:
          环境变量:
            PATH=/usr/local/nvidia/bin:/usr/local/cuda/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
            NVARCH=x86_64
            NVIDIA_REQUIRE_CUDA=cuda>=11.6 brand=tesla,driver>=418,driver<419 brand=tesla,driver>=450,driver<451 brand=tesla,driver>=470,driver<471 brand=unknown,driver>=470,driver<471 brand=nvidia,driver>=470,driver<471 brand=nvidiartx,driver>=470,driver<471 brand=geforce,driver>=470,driver<471 brand=geforcertx,driver>=470,driver<471 brand=quadro,driver>=470,driver<471 brand=quadrortx,driver>=470,driver<471 brand=titan,driver>=470,driver<471 brand=titanrtx,driver>=470,driver<471
            NV_CUDA_CUDART_VERSION=11.6.55-1
            NV_CUDA_COMPAT_PACKAGE=cuda-compat-11-6
            CUDA_VERSION=11.6.2
            LD_LIBRARY_PATH=/usr/local/nvidia/lib:/usr/local/nvidia/lib64
            NVIDIA_VISIBLE_DEVICES=all
            NVIDIA_DRIVER_CAPABILITIES=compute,utility
            NV_CUDA_LIB_VERSION=11.6.2-1
            NV_NVTX_VERSION=11.6.124-1
            NV_LIBNPP_VERSION=11.6.3.124-1
            NV_LIBNPP_PACKAGE=libnpp-11-6=11.6.3.124-1
            NV_LIBCUSPARSE_VERSION=11.7.2.124-1
            NV_LIBCUBLAS_PACKAGE_NAME=libcublas-11-6
            NV_LIBCUBLAS_VERSION=11.9.2.110-1
            NV_LIBCUBLAS_PACKAGE=libcublas-11-6=11.9.2.110-1
            NV_LIBNCCL_PACKAGE_NAME=libnccl2
            NV_LIBNCCL_PACKAGE_VERSION=2.12.10-1
            NCCL_VERSION=2.12.10-1
            NV_LIBNCCL_PACKAGE=libnccl2=2.12.10-1+cuda11.6
            NVIDIA_PRODUCT_NAME=CUDA
            NV_CUDA_CUDART_DEV_VERSION=11.6.55-1
            NV_NVML_DEV_VERSION=11.6.55-1
            NV_LIBCUSPARSE_DEV_VERSION=11.7.2.124-1
            NV_LIBNPP_DEV_VERSION=11.6.3.124-1
            NV_LIBNPP_DEV_PACKAGE=libnpp-dev-11-6=11.6.3.124-1
            NV_LIBCUBLAS_DEV_VERSION=11.9.2.110-1
            NV_LIBCUBLAS_DEV_PACKAGE_NAME=libcublas-dev-11-6
            NV_LIBCUBLAS_DEV_PACKAGE=libcublas-dev-11-6=11.9.2.110-1
            NV_NVPROF_VERSION=11.6.124-1
            NV_NVPROF_DEV_PACKAGE=cuda-nvprof-11-6=11.6.124-1
            NV_LIBNCCL_DEV_PACKAGE_NAME=libnccl-dev
            NV_LIBNCCL_DEV_PACKAGE_VERSION=2.12.10-1
            NV_LIBNCCL_DEV_PACKAGE=libnccl-dev=2.12.10-1+cuda11.6
            LIBRARY_PATH=/usr/local/cuda/lib64/stubs

          端口映射:    5001/tcp -> 5001; 8000/tcp -> 8000
          挂载点:    /home/z/模板 -> /home/data
          重启策略: always
      ```

    + 10.189.230.22 服务器 执行步骤
      ```bash
        z@z-SYS-4029GP-TRT:~$ docker ps -a
        CONTAINER ID   IMAGE          COMMAND                   CREATED         STATUS                  PORTS                                                                                  NAMES
        ca51df3d8f94   e3af5c5202c9   "/opt/nvidia/nvidia_…"   13 months ago   Exited (0) 2 days ago   0.0.0.0:5001->5001/tcp, :::5001->5001/tcp, 0.0.0.0:8000->8000/tcp, :::8000->8000/tcp    silly_hodgkin

        z@z-SYS-4029GP-TRT:~/SSH_DEV$ docker ps
        CONTAINER ID   IMAGE          COMMAND                   CREATED         STATUS        PORTS                                                                                  NAMES
        ca51df3d8f94   e3af5c5202c9   "/opt/nvidia/nvidia_…"   13 months ago   Up 18 hours   0.0.0.0:5001->5001/tcp, :::5001->5001/tcp, 0.0.0.0:8000->8000/tcp, :::8000->8000/tcp   silly_hodgkin

        # 1. commit 容器
        > docker commit ca51df3d8f94 graphics_algorithm_image

        # 查看镜像
        root@z-SYS-4029GP-TRT:/home/z/SSH_DEV# docker images -a
        REPOSITORY                    TAG       IMAGE ID       CREATED         SIZE
        graphics_algorithm_image_22   latest    d979c1d6f810   4 minutes ago   30.5GB  # [新镜像]
        <none>                        <none>    e3af5c5202c9   14 months ago   30.4GB  # [旧镜像无名]
      ```
      + 解决方案
        + 1. 运行新容器
        + [创建启动脚本](./run_services.sh)
        + [启动脚本](./run_services.sh) 放至 服务器 `/home/z/模板/ultralytics` 路径下
      ```bash
        # 执行 run 命令
        docker run -d \
          --name graphics_algorithm \
          --restart=always \
          --gpus all \
          --cpus 36 \
          -p 5001:5001 \
          -p 8000:8000 \
          -p 8082:8082 \
          -v /home/z/模板:/home/data \
          --shm-size 32g \
          graphics_algorithm_image_22 \
          /bin/bash -c "cd /home/data/ultralytics/ && chmod +x run_services.sh && ./run_services.sh"

        # 后续与23服务器一致
      ```

      + [新容器名称:graphics_algorithm;ID:2dea4ab8f0b5]
      ```bash
        z@z-SYS-4029GP-TRT:~$ docker ps -a
        CONTAINER ID   IMAGE                         COMMAND                   CREATED          STATUS                      PORTS                                                                                                                             NAMES
        2dea4ab8f0b5   graphics_algorithm_image_22   "/opt/nvidia/nvidia_…"   14 minutes ago   Up 14 minutes               0.0.0.0:5001->5001/tcp, :::5001->5001/tcp, 0.0.0.0:8000->8000/tcp, :::8000->8000/tcp, 0.0.0.0:8082->8082/tcp, :::8082->8082/tcp   graphics_algorithm
        ca51df3d8f94   e3af5c5202c9                  "/opt/nvidia/nvidia_…"   13 months ago    Exited (0) 54 minutes ago                                                                                                                                     silly_hodgkin
      ```

      + 本地调试 SSH映射
      ```bash
        ssh -L 0.0.0.0:8022:0.0.0.0:8000 z@47.93.245.95 -p 16080 -Nf
        ssh -L 0.0.0.0:8022:localhost:8000 z@47.93.245.95 -p 16080 -Nf
      ```

    + 10.189.230.23 服务器 执行步骤
      ```bash
        > z@z-SYS-4029GP-TRT:~$ docker ps -a
        CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS                                            NAMES
        fecb0bf809ff        e3af5c5202c9        "/opt/nvidia/nvidia_…"   13 months ago       Exited (255) 38 hours ago   0.0.0.0:5001->5001/tcp, 0.0.0.0:8000->8000/tcp   dazzling_kapitsa

        # 1. commit 容器
        > docker commit dazzling_kapitsa graphics_algorithm_image

        # 查看镜像
        > z@z-SYS-4029GP-TRT:~$ docker images -a
        REPOSITORY                 TAG                 IMAGE ID            CREATED             SIZE
        graphics_algorithm_image   latest              c2f05f3cd7ad        28 seconds ago      30.5GB  # [新镜像]
        <none>                     <none>              e3af5c5202c9        14 months ago       30.4GB  # [旧镜像无名]
        cuda                       latest              90f358f94f61        14 months ago       17.4GB
      ```

      + 解决方案
        + 1. 运行新容器
        + [创建启动脚本](./run_services.sh)
        + [启动脚本](./run_services.sh) 放至 服务器 `/home/z/模板/ultralytics` 路径下
      ```bash
        # 执行 run 命令
        docker run -d \
          --name graphics_algorithm \
          --restart=always \
          --gpus all \
          --cpus 36 \
          -p 5001:5001 \
          -p 8000:8000 \
          -p 8082:8082 \
          -v /home/z/模板:/home/data \
          --shm-size 32g \
          graphics_algorithm_image \
          /bin/bash -c "cd /home/data/ultralytics/ && chmod +x run_services.sh && ./run_services.sh"

        # 调试模式  进入容器调试
        docker run -it --rm \
          -v /home/z/模板:/home/data \
          graphics_algorithm_image \
          /bin/bash
      ```

      + [新容器名称:graphics_algorithm;ID:b667e68f9202]
      ```bash
        root@z-SYS-4029GP-TRT:/home/z/模板/ultralytics# docker ps -a
        CONTAINER ID        IMAGE                      COMMAND                  CREATED             STATUS                    PORTS                                                                    NAMES
        b667e68f9202        graphics_algorithm_image   "/opt/nvidia/nvidia_…"   7 minutes ago       Up 7 minutes              0.0.0.0:5001->5001/tcp, 0.0.0.0:8000->8000/tcp, 0.0.0.0:8082->8082/tcp   graphics_algorithm[新容器]
        fecb0bf809ff        e3af5c5202c9               "/opt/nvidia/nvidia_…"   13 months ago       Exited (255) 3 days ago   0.0.0.0:5001->5001/tcp, 0.0.0.0:8000->8000/tcp                           dazzling_kapitsa[老容器]
      ```

      + 本地调试 SSH映射
      ```bash
        ssh -L 0.0.0.0:8023:0.0.0.0:8000 z@47.93.245.95 -p 16081 -Nf
        ssh -L 0.0.0.0:8023:localhost:8000 z@47.93.245.95 -p 16081 -Nf
      ```

    + 重建 docker 原始 run命令
      ```bash
        z@z-SYS-4029GP-TRT:~$ docker ps -a
        CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS                                            NAMES
        fecb0bf809ff        e3af5c5202c9        "/opt/nvidia/nvidia_…"   13 months ago       Exited (255) 40 hours ago   0.0.0.0:5001->5001/tcp, 0.0.0.0:8000->8000/tcp   dazzling_kapitsa

        # 使用 docker inspect
        docker inspect fecb0bf809ff --format='{{range .Config.Env}}{{println .}}{{end}}{{range .Args}}{{println .}}{{end}}'
          PATH=/usr/local/nvidia/bin:/usr/local/cuda/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
          NVARCH=x86_64
          NVIDIA_REQUIRE_CUDA=cuda>=11.6 brand=tesla,driver>=418,driver<419 brand=tesla,driver>=450,driver<451 brand=tesla,driver>=470,driver<471 brand=unknown,driver>=470,driver<471 brand=nvidia,driver>=470,driver<471 brand=nvidiartx,driver>=470,driver<471 brand=geforce,driver>=470,driver<471 brand=geforcertx,driver>=470,driver<471 brand=quadro,driver>=470,driver<471 brand=quadrortx,driver>=470,driver<471 brand=titan,driver>=470,driver<471 brand=titanrtx,driver>=470,driver<471
          NV_CUDA_CUDART_VERSION=11.6.55-1
          NV_CUDA_COMPAT_PACKAGE=cuda-compat-11-6
          CUDA_VERSION=11.6.2
          LD_LIBRARY_PATH=/usr/local/nvidia/lib:/usr/local/nvidia/lib64
          NVIDIA_VISIBLE_DEVICES=all
          NVIDIA_DRIVER_CAPABILITIES=compute,utility
          NV_CUDA_LIB_VERSION=11.6.2-1
          NV_NVTX_VERSION=11.6.124-1
          NV_LIBNPP_VERSION=11.6.3.124-1
          NV_LIBNPP_PACKAGE=libnpp-11-6=11.6.3.124-1
          NV_LIBCUSPARSE_VERSION=11.7.2.124-1
          NV_LIBCUBLAS_PACKAGE_NAME=libcublas-11-6
          NV_LIBCUBLAS_VERSION=11.9.2.110-1
          NV_LIBCUBLAS_PACKAGE=libcublas-11-6=11.9.2.110-1
          NV_LIBNCCL_PACKAGE_NAME=libnccl2
          NV_LIBNCCL_PACKAGE_VERSION=2.12.10-1
          NCCL_VERSION=2.12.10-1
          NV_LIBNCCL_PACKAGE=libnccl2=2.12.10-1+cuda11.6
          NVIDIA_PRODUCT_NAME=CUDA
          NV_CUDA_CUDART_DEV_VERSION=11.6.55-1
          NV_NVML_DEV_VERSION=11.6.55-1
          NV_LIBCUSPARSE_DEV_VERSION=11.7.2.124-1
          NV_LIBNPP_DEV_VERSION=11.6.3.124-1
          NV_LIBNPP_DEV_PACKAGE=libnpp-dev-11-6=11.6.3.124-1
          NV_LIBCUBLAS_DEV_VERSION=11.9.2.110-1
          NV_LIBCUBLAS_DEV_PACKAGE_NAME=libcublas-dev-11-6
          NV_LIBCUBLAS_DEV_PACKAGE=libcublas-dev-11-6=11.9.2.110-1
          NV_NVPROF_VERSION=11.6.124-1
          NV_NVPROF_DEV_PACKAGE=cuda-nvprof-11-6=11.6.124-1
          NV_LIBNCCL_DEV_PACKAGE_NAME=libnccl-dev
          NV_LIBNCCL_DEV_PACKAGE_VERSION=2.12.10-1
          NV_LIBNCCL_DEV_PACKAGE=libnccl-dev=2.12.10-1+cuda11.6
          LIBRARY_PATH=/usr/local/cuda/lib64/stubs
          /bin/bash

        # 完整重建步骤：
        # 1. ​​获取基础信息​​
        docker inspect fecb0bf809ff --format='
          容器名称: {{.Name}}
          镜像: {{.Config.Image}}
          入口点: {{json .Config.Entrypoint}}
          命令: {{json .Config.Cmd}}
          工作目录: {{.Config.WorkingDir}}
          环境变量: {{range .Config.Env}}{{println "  " .}}{{end}}
          端口映射: {{range $p, $conf := .NetworkSettings.Ports}}{{println "  " $p "->" (index $conf 0).HostPort}}{{end}}
          挂载点: {{range .Mounts}}{{println "  " .Source "->" .Destination}}{{end}}
          重启策略: {{.HostConfig.RestartPolicy.Name}}
        '
        # 运行结果
          容器名称: /dazzling_kapitsa
          镜像: e3af5c5202c9
          入口点: ["/opt/nvidia/nvidia_entrypoint.sh"]
          命令: ["/bin/bash"]
          工作目录:
          环境变量:    PATH=/usr/local/nvidia/bin:/usr/local/cuda/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
            NVARCH=x86_64
            NVIDIA_REQUIRE_CUDA=cuda>=11.6 brand=tesla,driver>=418,driver<419 brand=tesla,driver>=450,driver<451 brand=tesla,driver>=470,driver<471 brand=unknown,driver>=470,driver<471 brand=nvidia,driver>=470,driver<471 brand=nvidiartx,driver>=470,driver<471 brand=geforce,driver>=470,driver<471 brand=geforcertx,driver>=470,driver<471 brand=quadro,driver>=470,driver<471 brand=quadrortx,driver>=470,driver<471 brand=titan,driver>=470,driver<471 brand=titanrtx,driver>=470,driver<471
            NV_CUDA_CUDART_VERSION=11.6.55-1
            NV_CUDA_COMPAT_PACKAGE=cuda-compat-11-6
            CUDA_VERSION=11.6.2
            LD_LIBRARY_PATH=/usr/local/nvidia/lib:/usr/local/nvidia/lib64
            NVIDIA_VISIBLE_DEVICES=all
            NVIDIA_DRIVER_CAPABILITIES=compute,utility
            NV_CUDA_LIB_VERSION=11.6.2-1
            NV_NVTX_VERSION=11.6.124-1
            NV_LIBNPP_VERSION=11.6.3.124-1
            NV_LIBNPP_PACKAGE=libnpp-11-6=11.6.3.124-1
            NV_LIBCUSPARSE_VERSION=11.7.2.124-1
            NV_LIBCUBLAS_PACKAGE_NAME=libcublas-11-6
            NV_LIBCUBLAS_VERSION=11.9.2.110-1
            NV_LIBCUBLAS_PACKAGE=libcublas-11-6=11.9.2.110-1
            NV_LIBNCCL_PACKAGE_NAME=libnccl2
            NV_LIBNCCL_PACKAGE_VERSION=2.12.10-1
            NCCL_VERSION=2.12.10-1
            NV_LIBNCCL_PACKAGE=libnccl2=2.12.10-1+cuda11.6
            NVIDIA_PRODUCT_NAME=CUDA
            NV_CUDA_CUDART_DEV_VERSION=11.6.55-1
            NV_NVML_DEV_VERSION=11.6.55-1
            NV_LIBCUSPARSE_DEV_VERSION=11.7.2.124-1
            NV_LIBNPP_DEV_VERSION=11.6.3.124-1
            NV_LIBNPP_DEV_PACKAGE=libnpp-dev-11-6=11.6.3.124-1
            NV_LIBCUBLAS_DEV_VERSION=11.9.2.110-1
            NV_LIBCUBLAS_DEV_PACKAGE_NAME=libcublas-dev-11-6
            NV_LIBCUBLAS_DEV_PACKAGE=libcublas-dev-11-6=11.9.2.110-1
            NV_NVPROF_VERSION=11.6.124-1
            NV_NVPROF_DEV_PACKAGE=cuda-nvprof-11-6=11.6.124-1
            NV_LIBNCCL_DEV_PACKAGE_NAME=libnccl-dev
            NV_LIBNCCL_DEV_PACKAGE_VERSION=2.12.10-1
            NV_LIBNCCL_DEV_PACKAGE=libnccl-dev=2.12.10-1+cuda11.6
            LIBRARY_PATH=/usr/local/cuda/lib64/stubs
          端口映射:    5001/tcp -> 5001   8000/tcp -> 8000
          挂载点:    /home/z/模板 -> /home/data
          重启策略: no
      ```

      + Linux 检测目录大小 命令
      ```bash
        du -sh /home/z/模板/ultralytics
          # • du: 磁盘使用情况命令
          # • -s: 只显示总大小（不显示子目录）
          # • -h: 以人类可读格式显示（KB/MB/GB）
          # • ​​输出示例​​：4.2G /home/z/模板/ultralytics

        # 详细目录大小分析
        du -h --max-depth=1 /home/z/模板/ultralytics
          # • --max-depth=1: 只显示一级子目录的大小
          # • ​​输出示例​​:
            2.1G    /home/z/模板/ultralytics/datasets
            1.5G    /home/z/模板/ultralytics/models
            600M    /home/z/模板/ultralytics/runs
            4.2G    /home/z/模板/ultralytics
      ```

  + 拉取线上 误报图片数据 本地运行分析

# 2025年9月11日 周四
  + 山西数字人
    + mstsc远程桌面 14.78.1.68/1234(VPN)

# 2025年9月12日 周五
  + [配置调试页面](配置调试页面.md)
    - 端口映射
      ```bahs
        # 前置条件
        # 1.frp 内网穿透服务已启动
        # 2.算法Docker服务已启动
        ssh -L 0.0.0.0:8022:0.0.0.0:8000 z@47.93.245.95 -p 16080 -Nf
        ssh -L 0.0.0.0:8023:0.0.0.0:8000 z@47.93.245.95 -p 16081 -Nf
        ssh -L 0.0.0.0:8010:0.0.0.0:8000 z@47.93.245.95 -p 16082 -Nf
      ```

    * [代理服务器](custom-server.js)
      支持 自定义 端口. 以 如下方式 启动服务
        p1 监听端口
        p2 代理端口
      ```bash
        # 代理 22 服务器
        node custom-server.js -p1 8122 -p2 8022
        # 代理 23 服务器
        node custom-server.js -p1 8123 -p2 8023
      ```

# 2025年9月15日 周一
  + 拉取线上 误报图片数据 本地运行分析
    - 22服务器
      - 20250831数据
        uri:
          `/det/2025-08-31/10.189.230.56/10.189.230.56_2025-08-31_14-45-57.21575.jpg`
      - 20250901数据
        uri:
          `/det/2025-09-01/10.189.230.56/`

    + 问题分析

    + WSGI 服务器
      ```bash
        pip install gunicorn
        gunicorn -w 4 -b 0.0.0.0:5001 recive_file:app

        pip install waitress
        waitress-serve --host=0.0.0.0 --port=5001 recive_file:app
      ```

  + [YOLO优化步骤](YOLO优化.md)

# 2025年9月16日 周二
  + [石太高速 [2. 二阶段功能需求]]
    2.2 预警数据时效性(2h)
      只修改前端 逻辑，不涉及接口字段调整
    2.3 拥堵路段(已完成)
    2.4 数字大屏尺寸调整(2天)
      * ![修改之前就没有数据！！！](image-6.png)
      1. 调整分辨率(4H)
        根据指定分辨率 确认 宽高比
      2. 组件轮播动画(动画调整 费时间 1天)
      3. 图层控制图标颜色问题(需要确认入口)(0.5H)
      4. 下拉框位置突兀 没有底色，这个需要和 UI确认(4H)
    2.5 事件预警管理优化(一天)
      5. 搜索条件变更说明(3H)
        涉及接口字段 数据字典
      6. 列表变更内容(3H)
        涉及接口字段 数据字典
      2.5.1.2 预警信息详情
        涉及接口字段 数据字典
    2.6 事件工作台优化(一天)
      2.6.1 左侧操作区(4H)
        涉及接口字段 数据字典
      2.6.2 事件预警
        涉及接口字段 数据字典

    + 开发时间 4.5天

# 2025年9月17日 周三
  + 广西来都路
    XRK: 429 509 760/1234567s

  + 排查数字人服务 2025年9月17日 14:36:11
    + 开启VPN后 [服务无法访问](https://14.78.1.86/index.html)
    + SSH登录 查看服务器状态，docker正常运行
    切换 clash 代理后，重启 vpn代理后 即可正常访问

# 2025年9月18日 周四
  + [ARM真人声音TTS](https://mp.weixin.qq.com/s/lfvVKnmLGfTKVXOR_YLFig)

# 2025年9月19日 周五
  + `深度智能体`四个关键特征
    1. Planning – keeps agents on track
    2. File system – allows agents to offload context
    3. Sub-agents – act as focused specialists
    4. Prompting – provides agents with detailed instructions
