<!--
 * @Description:
 * @Date: 2025-09-01 11:45:38
 * @LastEditTime: 2025-09-01 12:01:53
 * @FilePath: \blogSrc\source\_posts\工作学习日记\25年\9月\SSH.md
-->
+ Q
  需求
    A为开发主机，B为跳板机，C为内网服务器
    A主机通过 todesk 远程控制 B跳板机，然后 操作B跳板机 内网 登录 C内网服务器。
    我现在如何 在A主机，通过 SSH 远程登录 C服务器？

---

+ A
要在A主机通过SSH直接登录C服务器（需经过B跳板机中转），可以通过**SSH端口转发**或**SSH代理跳转**实现。以下是两种具体方法：


### 方法一：通过SSH代理命令（推荐，单条命令直接登录）
利用SSH的 `-J` 选项（Jump Host，跳转主机），直接从A主机通过B跳板机连接C服务器，无需手动配置端口转发。

#### 操作步骤：
1. 在A主机的终端（Windows可使用PowerShell、Git Bash，Linux/macOS直接用终端）运行以下命令：
   ```bash
   ssh -J 用户名@B跳板机的内网IP 用户名@C服务器的内网IP
   ```
   - 解释：`-J` 表示通过中间跳板机（B）连接目标主机（C）。
   - 替换参数：
     - `用户名@B跳板机的内网IP`：你登录B跳板机的用户名和B的内网IP（例如 `userB@192.168.1.10`）。
     - `用户名@C服务器的内网IP`：你登录C服务器的用户名和C的内网IP（例如 `userC@192.168.1.20`）。

2. 执行后，会先要求输入B跳板机的登录密码（或密钥验证），验证通过后，再要求输入C服务器的登录密码（或密钥验证），成功后即可直接在A主机的终端操作C服务器。


### 方法二：通过SSH本地端口转发（适合需要持久连接或多工具使用）
通过A主机建立一个本地端口，将该端口的流量通过B跳板机转发到C服务器的SSH端口（默认22），之后通过连接本地端口间接访问C。

#### 操作步骤：
1. 在A主机的终端运行端口转发命令：
   ```bash
   ssh -L 本地端口:B跳板机的内网IP:C服务器的SSH端口 用户名@B跳板机的内网IP
   ```
   - 替换参数：
     - `本地端口`：A主机上任意未被占用的端口（例如 `2222`）。
     - `B跳板机的内网IP`：B的内网IP（例如 `192.168.1.10`）。
     - `C服务器的SSH端口`：C的SSH端口（默认22，若未修改则填22）。
     - `用户名@B跳板机的内网IP`：登录B的用户名和IP（例如 `userB@192.168.1.10`）。

   示例命令：
   ```bash
   ssh -L 2222:192.168.1.20:22 userB@192.168.1.10
   ```
   执行后，终端会停留在B跳板机的登录状态（不要关闭此窗口，保持转发通道）。

2. 另开一个A主机的终端，通过本地端口连接C服务器：
   ```bash
   ssh -p 本地端口 用户名@localhost
   ```
   示例（接上面的端口）：
   ```bash
   ssh -p 2222 userC@localhost
   ```
   输入C服务器的密码（或密钥验证），即可登录C。


### 注意事项：
1. **网络可达性**：确保A主机能通过Todesk访问B跳板机的内网IP（通常Todesk会建立虚拟局域网，默认支持内网访问）。
2. **密钥登录优化**：如果希望免密码登录，可以在A主机生成SSH密钥，将公钥分别添加到B跳板机的 `~/.ssh/authorized_keys` 和C服务器的 `~/.ssh/authorized_keys` 中，实现无密码跳转。
3. **工具支持**：如果使用PuTTY、Xshell等SSH客户端，可在软件中配置“代理/跳板机”选项，填入B的信息后直接连接C的内网IP。

两种方法都能实现A→B→C的SSH连接，方法一适合临时操作，方法二适合需要长时间连接或配合其他工具（如SFTP）使用的场景。
