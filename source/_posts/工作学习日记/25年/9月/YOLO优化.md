<!--
 * @Description:
 * @Date: 2025-09-15 14:34:15
 * @LastEditTime: 2025-09-15 14:35:12
 * @FilePath: \blogSrc\source\_posts\工作学习日记\25年\9月\YOLO优化.md
-->
# YOLOv8 阴影误检为人问题 优化步骤：

## 第一步：优化后处理参数（快速见效）
  - **调整置信度阈值**：默认置信度阈值通常为0.25，可逐步提升至0.4 - 0.6 ，根据实际测试进行调整。提高置信度阈值能过滤掉低置信度的检测结果，减少将阴影这类误检为“人”的情况。
  - **调整IOU阈值**：非极大值抑制（NMS）中的IOU阈值默认可能为0.7，可适当降低到0.5 - 0.6。这样能避免重叠的误检框被保留下来，进一步减少误检。
  - **添加目标尺寸过滤规则**：根据人体和阴影在宽高比、面积上的差异设置过滤规则。比如过滤掉面积过小（如小于30×30像素，具体需结合场景调整 ）的检测框，以及宽高比异常（如人体正常宽高比约在0.3 - 0.6之间，可设置合理的宽高比范围进行过滤）的检测框。

## 第二步：补充数据与标注（根本解决）
 - **采集负样本**：拍摄项目实际场景中不同光照下的阴影，包括地面阴影、墙面阴影、物体投射阴影等，还可以采集一些易被误检为人体的类似轮廓的阴影样本。采集数量初期补充100 - 200张即可，占现有正样本的30% - 50%为宜。
 - **标注负样本**：
    - **空白标注**：对于只有阴影、没有人的图像，其标注文件（`.txt`）保持为空，模型训练时会将其视为“无目标样本”。
    - **标注干扰类**：对于同时含人和阴影的图像，正常标注人的检测框，同时给阴影标注一个新增的“干扰类” ，如类别ID设为1，类别名设为“shadow”或“background”，并同步修改YOLOv8的配置文件（如`data.yaml`）中的`names`部分。
 - **样本划分与训练**：将负样本与现有正样本混合，70%的负样本放入训练集，30%放入验证集，负样本总数不超过总样本的40% 。使用现有预训练模型微调5 - 10轮，微调时学习率设为原训练的1/10 。

## 第三步：改进模型结构
 - **更换模型版本**：若当前使用的是轻量模型（如YOLOv8n、YOLOv8s），可以尝试更换为参数量更大、特征提取能力更强的YOLOv8m、YOLOv8l 版本。也可以优先尝试YOLOv8-p2模型，其新增的P2特征层能提升对小目标的检测能力，有助于区分阴影和人体细节。
 - **增加注意力模块**：在模型的Backbone或Neck层插入通道注意力模块，如SE、CBAM 。让模型更关注人体特有的高辨识度区域，如头部、躯干等，而不是仅关注阴影的轮廓。
 - **微调模型**：使用项目现场采集的包含人以及阴影的混合数据，对预训练模型进行微调。训练时可以适当提高干扰类（阴影类）的分类损失权重，让模型更注重区分人和阴影，学习率设为如`lr0=0.0001` 。

## 第四步：场景适配与预处理
 - **背景建模与动态过滤**：如果项目是固定场景，如监控摄像头场景，使用背景差分法（如MOG2算法）提取动态目标。由于阴影通常是静态的，通过背景建模得到动态掩码后，仅对掩码区域执行YOLOv8检测，可有效排除静态阴影的干扰。
 - **光照补偿预处理**：若阴影是由光照不均导致的，在检测前对图像进行预处理。例如，使用CLAHE算法增强局部对比度，使阴影区域与人体的灰度差异更明显；或者将图像转换为HSV颜色空间，单独调整亮度通道（V通道），抑制阴影带来的暗部干扰。
